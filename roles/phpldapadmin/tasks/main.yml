- name: Install packages needed (PHP, HTTPD, PHP-LDAP, MOD_SSL)
  yum:
    name:
      - httpd
      - php
      - php-ldap
      - mod_ssl
      
    state: installed

- name: Download phpLDAPadmin from Sirepo and move to /usr/share/phpldapadmin
  unarchive:
    src: https://sirepo.s3-eu-west-1.amazonaws.com/phpldapadmin.zip
    dest: /usr/share/
    remote_src: yes
    owner: "apache"
    group: "apache"

- name: Create config file phpldapadmin
  copy:
    src: /usr/share/phpldapadmin/config/config.php.example
    dest: /usr/share/phpldapadmin/config/config.php
    owner: "apache"
    group: "apache"

- name: Create phpdlapadmin.conf en httpd
  copy:
    src: ./files/phpldapadmin.conf
    dest: /etc/httpd/conf.d/phpldapadmin.conf
    owner: "apache"
    group: "apache"

- name: Ensure the default Apache port is 8080
  lineinfile:
    path: /etc/httpd/conf/httpd.conf
    regexp: '^Listen '
    insertafter: '^#Listen '
    line: Listen 8080

- name: Enable service httpd, and start it
  service:
    name: httpd
    state: started
    enabled: yes
   